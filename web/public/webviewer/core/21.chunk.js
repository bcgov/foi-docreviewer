/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{535:function(wa,sa,h){h.r(sa);var pa=h(0),oa=h(7),ma=h(3);wa=h(49);var ia=h(28),ja=h(13);h=function(){function ea(){this.init()}ea.prototype.init=function(){this.kga=!1;this.Lf=this.Ym=this.connection=null;this.wu={};this.ga=this.tJ=null};ea.prototype.oAa=function(y){for(var x=this,f=0;f<y.length;++f){var e=y[f];switch(e.at){case "create":this.wu[e.author]||(this.wu[e.author]=e.aName);this.npa(e);break;case "modify":this.ga.Xp(e.xfdf).then(function(a){x.ga.vb(a[0])});
break;case "delete":this.ga.Xp("<delete><id>"+e.aId+"</id></delete>")}}};ea.prototype.npa=function(y){var x=this;this.ga.Xp(y.xfdf).then(function(f){f=f[0];f.authorId=y.author;x.ga.vb(f);x.ga.trigger(oa.c.UPDATE_ANNOTATION_PERMISSION,[f])})};ea.prototype.Koa=function(y,x,f){this.Ym&&this.Ym(y,x,f)};ea.prototype.preloadAnnotations=function(y){this.addEventListener("webViewerServerAnnotationsEnabled",this.Koa.bind(this,y,"add",{imported:!1}),{once:!0})};ea.prototype.initiateCollaboration=function(y,
x,f){var e=this;if(y){e.Lf=x;e.ga=f.ma();f.addEventListener(oa.h.DOCUMENT_UNLOADED,function(){e.disableCollaboration()});e.RAa(y);var a=new XMLHttpRequest;a.addEventListener("load",function(){if(200===a.status&&0<a.responseText.length)try{var b=JSON.parse(a.responseText);e.connection=exports.da.CBa(Object(ia.k)(e.Lf,"blackbox/"),"annot");e.tJ=b.id;e.wu[b.id]=b.user_name;e.ga.OR(b.id);e.connection.bFa(function(n){n.t&&n.t.startsWith("a_")&&n.data&&e.oAa(n.data)},function(){e.connection.send({t:"a_retrieve",
dId:y});e.trigger(ea.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[e.wu[b.id],e.tJ])},function(){e.disableCollaboration()})}catch(n){Object(ma.g)(n.message)}});a.open("GET",Object(ia.k)(this.Lf,"demo/SessionInfo.jsp"));a.withCredentials=!0;a.send();e.kga=!0;e.ga.J6(function(b){return e.wu[b.Author]||b.Author})}else Object(ma.g)("Document ID required for collaboration")};ea.prototype.disableCollaboration=function(){this.Ym&&(this.ga.removeEventListener(ja.a.Events.ANNOTATION_CHANGED,this.Ym),this.Ym=
null);this.connection&&this.connection.Kr();this.ga&&this.ga.OR("Guest");this.init();this.trigger(ea.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ea.prototype.RAa=function(y){var x=this;this.Ym&&this.ga.removeEventListener(ja.a.Events.ANNOTATION_CHANGED,this.Ym);this.Ym=function(f,e,a){return Object(pa.b)(this,void 0,void 0,function(){var b,n,r,z,w,ba,fa,aa,ca;return Object(pa.d)(this,function(ha){switch(ha.label){case 0:if(a.imported)return[2];b={t:"a_"+e,dId:y,annots:[]};return[4,x.ga.QZ()];case 1:n=
ha.ba();"delete"!==e&&(r=(new DOMParser).parseFromString(n,"text/xml"),z=new XMLSerializer);for(w=0;w<f.length;w++)ba=f[w],aa=fa=void 0,"add"===e?(fa=r.querySelector('[name="'+ba.Id+'"]'),aa=z.serializeToString(fa),ca=null,ba.InReplyTo&&(ca=x.ga.wg(ba.InReplyTo).authorId||"default"),b.annots.push({at:"create",aId:ba.Id,author:x.tJ,aName:x.wu[x.tJ],parent:ca,xfdf:"<add>"+aa+"</add>"})):"modify"===e?(fa=r.querySelector('[name="'+ba.Id+'"]'),aa=z.serializeToString(fa),b.annots.push({at:"modify",aId:ba.Id,
xfdf:"<modify>"+aa+"</modify>"})):"delete"===e&&b.annots.push({at:"delete",aId:ba.Id});0<b.annots.length&&x.connection.send(b);return[2]}})})}.bind(x);this.ga.addEventListener(ja.a.Events.ANNOTATION_CHANGED,this.Ym)};ea.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ea}();Object(wa.a)(h);sa["default"]=h}}]);}).call(this || window)
